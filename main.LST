C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c COMPACT BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "main.h"
   2          #include "LCD12864.h"
   3          #include "stc12c56.h"
   4          #include "pindef.h"
   5          #include "bmp.h"
   6          #include "eeprom.h"
   7          
   8          uchar key_zero = 0;
   9          uchar sd_kind = 0;
  10          uchar PF[2];
  11          //ƒ⁄¥Ê∂®“Â
  12          /************************************************************/
  13          //#define PF1     0x5A  //≈‰∑Ω1 …»«¯
  14          //#define PF2     0x5C  //≈‰∑Ω2 …»«¯
  15          //#define PF3     0x5E  //≈‰∑Ω3 …»«¯
  16          //#define PF4     0x60  //≈‰∑Ω4 …»«¯
  17          //#define PF5     0x62  //≈‰∑Ω5 …»«¯
  18          //#define PF6     0x64  //≈‰∑Ω6 …»«¯
  19          //#define PF7     0x66  //≈‰∑Ω7 …»«¯
  20          //#define PF8     0x68  //≈‰∑Ω8 …»«¯
  21          //#define PF9     0x6A  //≈‰∑Ω9 …»«¯
  22          //#define PF10    0x6C  //≈‰∑Ω10…»«¯
  23          //#define PF11    0x6E  //≈‰∑Ω11…»«¯
  24          
  25          //save
  26          //#define PF1     0x4A  //≈‰∑Ω1 …»«¯
  27          //#define PF2     0x4C  //≈‰∑Ω2 …»«¯
  28          //#define PF3     0x4E  //≈‰∑Ω3 …»«¯
  29          //#define PF4     0x40  //≈‰∑Ω4 …»«¯
  30          //#define PF5     0x42  //≈‰∑Ω5 …»«¯
  31          //#define PF6     0x44  //≈‰∑Ω6 …»«¯
  32          //#define PF7     0x46  //≈‰∑Ω7 …»«¯
  33          //#define PF8     0x48  //≈‰∑Ω8 …»«¯
  34          //#define PF9     0x4A  //≈‰∑Ω9 …»«¯
  35          //#define PF10    0x4C  //≈‰∑Ω10…»«¯
  36          //#define PF11    0x4E  //≈‰∑Ω11…»«¯
  37          
  38          //PFID-> WLSL(ŒÔ¡œ ˝¡ø)
  39          //HBIT 0x46
  40          
  41          //◊”À˜“˝∂®“Â
  42          //0x01,0x02 ŒÔ¡œ1
  43          //0x03,0x04 ŒÔ¡œ1
  44          //0x05,0x06 ŒÔ¡œ1
  45          //0x07,0x08 ŒÔ¡œ1
  46          //0x09,0x0a ŒÔ¡œ1
  47          //0x0b,0x0c ŒÔ¡œ1
  48          //0x0d,0x0e ŒÔ¡œ1
  49          //0x0f,0x10 ŒÔ¡œ1
  50          //0x11,0x12 ŒÔ¡œ1
  51          //0x13,0x14 ŒÔ¡œ1
  52          
  53          /************************************************************/
  54          /****÷˜∫Ø ˝****/
  55          //644
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 2   

  56          //¥¶¿Ìœ‘ æµƒ¡Ω÷÷∑Ω∑®£¨1°¢Õ®π˝ ∂±CLOCKµƒ∆µ¬ Ω· ¯ŒªΩ¯––«–ªª 2°¢Õ®π˝∑¢ÀÕLEDøÿ÷∆–æ∆¨µƒ∏¥Œª–≈∫≈°£
  57          ////////«∞4Œª
  58          //8->254
  59          //7->224
  60          //6->190
  61          //5->182
  62          //4->102
  63          //3->242
  64          //2->218
  65          //1->096
  66          //0->252
  67          //- -> 002
  68          //n -> 246
  69          //d -> 102
  70          //p -> 238
  71          //a -> 206
  72          
  73          //////////…œ1Œª
  74          //0 -> 000
  75          //1 -> 182
  76          void beep1()
  77          {
  78   1       uchar i;
  79   1        SW_KEY=0;
  80   1        for(i=0;i<4;i++)
  81   1        {delayL(40000);}
  82   1        SW_KEY=1;
  83   1        delayL(30000);
  84   1      }
  85          void beep3()
  86          {
  87   1      uchar i;
  88   1        //P25=0;
  89   1        for(i=0;i<4;i++)
  90   1        {delayL(40000);}
  91   1        SW_KEY=1;
  92   1        delayL(30000);
  93   1        SW_KEY=0;
  94   1        for(i=0;i<4;i++)
  95   1        {delayL(40000);}
  96   1        SW_KEY=1;
  97   1        delayL(30000);
  98   1        SW_KEY=0;
  99   1        for(i=0;i<4;i++)
 100   1        {delayL(40000);}
 101   1        SW_KEY=1;
 102   1        delayL(30000);
 103   1      }
 104          //∑¢ÀÕƒ£øÈ≥ı ºªØ//////////////////////////////////////
 105          void init_uart(void)
 106          {
 107   1       SCON=0x50;
 108   1       PCON=0x00;
 109   1       ES=1;
 110   1       TMOD=0x20;
 111   1       TL1=TH1 = 0xF8;
 112   1       //TH1=0xFB;
 113   1       TR1=1;
 114   1       EA=1;
 115   1       //IE=0; //∆¡±Œ÷–∂œ
 116   1      
 117   1       }
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 3   

 118          //∑¢ÀÕ∑Ω∑®////////////µ•◊÷Ω⁄∑¢ÀÕ∑Ω∑®”–≤π≥•£®≤‚ ‘”√£©/////////////////////////
 119          void send(unsigned char text)
 120           {
 121   1        ES=0;
 122   1        SBUF=text+0x30;
 123   1        while(!TI); 
 124   1        TI=0;
 125   1        ES=1;
 126   1       }
 127          //∑¢ÀÕ∑Ω∑®///////////µ•◊÷Ω⁄/////∑¢≤º∫Û π”√///////////////////////////////////
 128          void send_usual(unsigned char text)//’˝≥£∑¢ÀÕ
 129           {
 130   1        ES=0;
 131   1        SBUF=text;
 132   1        while(!TI); 
 133   1        TI=0;
 134   1        ES=1;
 135   1       }
 136          //Ω‚Œˆ ’µΩµƒ ˝æ›±‡≥ÃINT÷µ
 137          void recv_data()
 138          {
 139   1      sys_press = byte_read(0x58+(PFID*2),(WLID*2))*256+byte_read(0x58+(PFID*2),(WLID*2)+1);
 140   1      // sys_kinds = (recv_buf[6]-0x30)+(recv_buf[5]-0x30)*10;
 141   1      
 142   1         if(sys_press > sys_press_temp)//»Áπ˚œ¬¡œ÷ÿ¡ø¥Û”⁄…œ¥Œ…Ë∂®÷ÿ¡ø‘Úº”¡œ÷µŒ™‘ˆº”
 143   1          {
 144   2            addorarr = 0;
 145   2            addorarr_count = sys_press - sys_press_temp;
 146   2            sys_press_temp = sys_press;
 147   2          }
 148   1         if(sys_press < sys_press_temp)//»Áπ˚œ¬¡œ÷ÿ¡ø¥Û”⁄…œ¥Œ…Ë∂®÷ÿ¡ø‘Úº”¡œ÷µŒ™‘ˆº”
 149   1          {
 150   2         addorarr = 1;
 151   2         addorarr_count = sys_press_temp - sys_press;
 152   2         sys_press_temp = sys_press;
 153   2          }
 154   1      //if(sys_press == sys_press_temp)
 155   1      //{addorarr = 2;}
 156   1      
 157   1      //    sys_res_status = 1;//“—æ≠»∑»œΩ” ’µΩ ˝æ›
 158   1          delayL(20000);
 159   1          delayL(20000);
 160   1          delayL(20000);
 161   1          delayL(20000);
 162   1      
 163   1        }
 164          //Ω” ’∑Ω∑®//////////≤…”√÷–∂œ////////////////////////////////////////////////
 165          
 166          //’˚ÃÂ∑¢ÀÕƒ£øÈ£®≤‚ ‘”√£©///////////////////////////////////////////////
 167          void send_data(dis_V)
 168          {
 169   1        uchar temp,i,sy,j;
 170   1        for(j=0;j<15;j++)
 171   1        {delayL(20000);}
 172   1      //0xD1 »’∆⁄ ±º‰Õ∑£¨≤¢∑¢ÀÕƒ⁄»›
 173   1        //send_usual(0x44);
 174   1        //send_usual(0x31);   
 175   1      //»’∆⁄∑¢ÀÕ 
 176   1        //send_usual(0x32);
 177   1        //send_usual(0x30);
 178   1        //send_usual(0x31);
 179   1        //send_usual(0x33);
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 4   

 180   1        //send_usual(0x30);
 181   1        //send_usual(0x32);
 182   1        //send_usual(0x32);
 183   1        //send_usual(0x31);
 184   1      //0xD2 »’∆⁄ ±º‰Õ∑£¨≤¢∑¢ÀÕƒ⁄»›
 185   1        //send_usual(0x44);
 186   1        //send_usual(0x32);
 187   1      // ±º‰£¨ID∑¢ÀÕ
 188   1        //send_usual(0x31);
 189   1        //send_usual(0x34);
 190   1        //send_usual(0x31);
 191   1        //send_usual(0x33);
 192   1      //ID
 193   1          //send_usual(0x30);
 194   1        //send_usual(0x32);
 195   1        //send_usual(0x33);
 196   1      //≈‰∑Ω÷÷¿‡ID∑¢ÀÕ
 197   1      send_usual(0x4b);
 198   1      
 199   1                sy = sys_subjects;
 200   1                
 201   1                sy=sy/10;
 202   1                    send_usual((sy % 10)+'0');
 203   1                    
 204   1                sy = sys_subjects;
 205   1                    send_usual((sy % 10)+'0');
 206   1      //ŒÔ¡œ÷÷¿‡
 207   1      send_usual(0x4d);
 208   1      
 209   1                sy = sys_kind_temp;
 210   1                
 211   1                sy=sy/10;
 212   1                    send_usual((sy % 10)+'0');
 213   1                    
 214   1                sy = sys_kind_temp;
 215   1                    send_usual((sy % 10)+'0');
 216   1                    
 217   1      
 218   1      
 219   1      
 220   1      //œﬁ÷∆÷ÿ¡ø
 221   1      
 222   1      /*//∞¥º¸±Í ∂±®Õ∑
 223   1        send_usual(0x41);
 224   1        send_usual(0x31);
 225   1      //∞¥º¸±Í ∂ƒ⁄»›
 226   1          for(i = 0; i < 3; i++)
 227   1        {
 228   1          temp = KEY_BUF % 10;
 229   1          send(temp);
 230   1          KEY_BUF=KEY_BUF/10;
 231   1        }
 232   1      */
 233   1      //÷ÿ¡ø±Í ∂±®Õ∑
 234   1        send_usual(0x41);
 235   1        send_usual(0x32);
 236   1      //“‘œ¬Œ™÷ÿ¡ø÷µ ///////////////////////////////////////////////////////////////----------------------------
             ----write---------
 237   1          if(dis_V == 0)
 238   1           {ok_id2=1;}
 239   1           else{ok_id2=0;}
 240   1      //       for(i = 0; i < 5; i++)
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 5   

 241   1      //     {
 242   1      //       temp = dis_V % 10;
 243   1      //       send(temp);
 244   1      //       dis_V=dis_V/10;
 245   1      //     }
 246   1      //  send(fu_hao);
 247   1      
 248   1          //send(-0x26);//ªª––∑˚
 249   1      }
*** WARNING C280 IN LINE 169 OF main.c: 'temp': unreferenced local variable
*** WARNING C280 IN LINE 169 OF main.c: 'i': unreferenced local variable
 250          //Ω´∞¥º¸ ˝æ›◊È∫œ‘⁄“ª∆–Œ≥…16Ω¯÷∆ ˝////////////////////////////////////////////
 251          void Code2char()
 252          {
 253   1      uchar i;
 254   1      //µ⁄“ª◊È ˝æ›
 255   1      for(i=0;i<10;i++)
 256   1      {
 257   2        if(rev_1[0] == convertsw[i])
 258   2        {
 259   3          cvover = i;
 260   3        diswich++;  
 261   3        }
 262   2      }
 263   1      if((diswich == 0)&&(rev_1[0]==0))
 264   1      {diswich++;}
 265   1      if((diswich == 0)&&(rev_1[0]==2))
 266   1      {diswich++;
 267   2       fu_hao = -0x03;
 268   2      }
 269   1      //µ⁄∂˛◊È ˝æ›
 270   1      for(i=0;i<10;i++)
 271   1      {
 272   2        if(rev_1[1] == convertsw[i])
 273   2        {cvover = cvover+(i*10);
 274   3         diswich++;
 275   3        }
 276   2      }
 277   1      if((diswich == 1)&&(rev_1[1]==0))
 278   1      {diswich++;}
 279   1      if((diswich == 1)&&(rev_1[1]==2))
 280   1      {diswich++;
 281   2      fu_hao = -0x03;
 282   2      }
 283   1      if((diswich == 1)&&(rev_1[1]==238))
 284   1      {
 285   2      ZERO_SW = 1;
 286   2      }
 287   1      
 288   1      //µ⁄»˝◊È ˝æ›
 289   1      for(i=0;i<10;i++)
 290   1      {
 291   2        if(rev_1[2] == convertsw[i])
 292   2        {cvover = cvover+(i*100);
 293   3         diswich++;
 294   3        }
 295   2      }
 296   1      if((diswich == 2)&&(rev_1[2]==0))
 297   1      {diswich++;}
 298   1      if((diswich == 2)&&(rev_1[2]==2))
 299   1      {diswich++;
 300   2      fu_hao = -0x03;
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 6   

 301   2      }
 302   1      //µ⁄Àƒ◊È ˝æ›
 303   1      for(i=0;i<10;i++)
 304   1      {
 305   2        if(rev_1[3] == convertsw[i])
 306   2        {cvover = cvover+(i*1000);
 307   3         diswich++;
 308   3        }
 309   2      }
 310   1      if((diswich == 3)&&(rev_1[3]==0))
 311   1      {diswich++;}
 312   1      if((diswich == 3)&&(rev_1[3]==2))
 313   1      {diswich++;
 314   2      fu_hao = -0x03;
 315   2      }
 316   1      //µ⁄ŒÂ◊È ˝æ›
 317   1      if(rev_1[4] == 182)
 318   1      {//cvover = cvover+(1*10000); ∏¸∏ƒ‘≠“Ú£¨ ◊Œª≤ª“™¡À£¨–¬∞Ê±æ”–∏…»≈
 319   2      diswich++;
 320   2      }
 321   1      if((diswich == 4)&&(rev_1[4]==0))
 322   1      {diswich++;}
 323   1      
 324   1      
 325   1      if(diswich == 5)
 326   1       {
 327   2         //dis_data_led(cvover);
 328   2         send_data(cvover);
 329   2       }
 330   1      
 331   1      //“ª∏ˆ÷‹∆⁄÷Æ∫ÛΩ¯–– ˝æ›«Â¿Ì
 332   1      diswich = 0;
 333   1      cvover=0;
 334   1      fu_hao = -0x05;
 335   1      ZERO_SW = 0;
 336   1      
 337   1      }
 338          //◊•»°–≈∫≈÷˜∫Ø ˝/////////////////////////////////////////////////////
 339          void ReadPS2()
 340          {
 341   1         uchar i;
 342   1         while(PS_DATA == 1)
 343   1         {
 344   2           while(PS_CLK==0);
 345   2           while(PS_CLK==1);                                           
 346   2         while(!PS_CLK);   
 347   2         }
 348   1         for(i=0;i<8;i++)  //µ⁄“ª∂”¡–
 349   1         {
 350   2         while(PS_CLK);
 351   2         while(!PS_CLK);  
 352   2        if(PS_DATA == 1)
 353   2         {
 354   3           rev_1[0]++;
 355   3         }
 356   2         rev_1[0] = rev_1[0] << 1;     
 357   2         }   
 358   1         for(i=0;i<8;i++)  //µ⁄∂˛∂”¡–
 359   1         {
 360   2          while(PS_CLK);
 361   2          while(!PS_CLK); 
 362   2        if(PS_DATA == 1)
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 7   

 363   2         {
 364   3           rev_1[1]++;
 365   3         }
 366   2         rev_1[1]=rev_1[1]<<1;
 367   2          }
 368   1         for(i=0;i<8;i++)  //µ⁄»˝∂”¡–
 369   1         {
 370   2          while(PS_CLK);
 371   2          while(!PS_CLK); 
 372   2        if(PS_DATA == 1)
 373   2         {
 374   3           rev_1[2]++;
 375   3         }
 376   2         rev_1[2]=rev_1[2]<<1;
 377   2          }
 378   1         for(i=0;i<8;i++)  //µ⁄Àƒ∂”¡–
 379   1         {
 380   2          while(PS_CLK);
 381   2          while(!PS_CLK); 
 382   2        if(PS_DATA == 1)
 383   2         {
 384   3           rev_1[3]++;
 385   3         }
 386   2         rev_1[3]=rev_1[3]<<1;
 387   2          }    
 388   1         for(i=0;i<3;i++)  //µ⁄ŒÂ∂”¡–
 389   1         {
 390   2          while(PS_CLK);
 391   2          while(!PS_CLK); 
 392   2        if(PS_DATA == 1)
 393   2         {
 394   3           rev_1[4]++;
 395   3         }
 396   2         rev_1[4]=rev_1[4]<<1;
 397   2          }
 398   1       //P26=0; 
 399   1      
 400   1      }
 401          
 402          void clk_test()
 403          {
 404   1         ulong i=0;
 405   1         while(sw_clkchk == 0)
 406   1         {
 407   2           if(CHK_CLK == 0)
 408   2           {i++;}//‘⁄ ±÷”“˝Ω≈Œ™µÕµÁ∆Ωµƒ ±∫Úiµ›‘ˆº∆À„
 409   2         else{i=0;}//‘⁄ ±÷”“˝Ω≈Œ™∏ﬂµÁ∆Ωµƒ ±∫Úi«Â¡„
 410   2         if(i>300)
 411   2         {sw_clkchk = 1;}//µ±iº‰∏Ù ˝±‰¥Ûµƒ ±∫Ú÷§√˜ ±÷”œﬂ∑¢ÀÕ÷–∂œ£¨¥À ±ø…“‘◊‘∂Ø◊™ªªœ‘ æ°£ø™πÿ”…¥À¥Úø™°£
 412   2         }
 413   1         
 414   1      }
 415          void Set_press_int()
 416          {
 417   1      uchar i;
 418   1      ulong j;
 419   1         delayL(20000);
 420   1         delayL(20000);
 421   1         delayL(20000);
 422   1         delayL(20000);
 423   1         delayL(20000);
 424   1         delayL(20000);
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 8   

 425   1         delayL(20000);
 426   1         delayL(20000);
 427   1         delayL(20000);
 428   1         delayL(20000);
 429   1         ARR_KEY=0;
 430   1         ADD_KEY=0;
 431   1         for(i=0;i<25;i++)
 432   1         {delayL(10000);}//¥À¥¶÷Æ«∞Œ™Ω¯»Î…Ë∂®ƒ£ Ω
 433   1         ARR_KEY=1;
 434   1         ADD_KEY=1;
 435   1         for(i=0;i<55;i++)
 436   1         {delayL(20000);}//¥À¥¶÷Æ«∞Œ™Ω¯»Î…Ë∂®ƒ£ Ω
 437   1         delayL(20000);
 438   1         delayL(20000);
 439   1         delayL(20000);
 440   1         delayL(20000);
 441   1         delayL(20000);
 442   1         delayL(20000);
 443   1         delayL(20000);
 444   1      
 445   1      if(addorarr == 0)
 446   1       {
 447   2         for(j=0;j<addorarr_count;j++)
 448   2         {
 449   3         delayL(6000);
 450   3         ADD_KEY=0;//∞¥◊°
 451   3         delayL(8500);
 452   3         ADD_KEY=1;//ÀÕø™
 453   3         delayL(6000);     
 454   3         }
 455   2       }
 456   1      if(addorarr == 1)
 457   1       {
 458   2         for(j=0;j<addorarr_count;j++)
 459   2         {
 460   3         delayL(6000);
 461   3         ARR_KEY=0;//∞¥◊°
 462   3         delayL(8500);
 463   3         ARR_KEY=1;//ÀÕø™
 464   3         delayL(6000);  
 465   3         }
 466   2       }
 467   1         //¥À¥¶”¶∑µªÿ…Ë∂®Ω·π˚°£
 468   1         sys_res_status=20;  //¥À ±œµÕ≥Ω¯»ÎŒﬁœﬁµ»¥˝◊¥Ã¨£¨≤ª◊ˆ»Œ∫Œ∑¢ÀÕ
 469   1      
 470   1      }
 471          int bit0o1(int it,int position) 
 472          {     
 473   1       int oc=1;     
 474   1       oc<<=(position);     
 475   1       return (oc&it)!=0?1:0; 
 476   1      } 
 477          void Display_LED()
 478          {
 479   1      
 480   1      uchar i;
 481   1      PS_DATA = 0;
 482   1      PS_CLK = 0;
 483   1      delayL(1000);
 484   1      //≥ı ºªØ
 485   1      //ø™ª˙∂Œ∑¢ÀÕ
 486   1      PS_CLK = 1;//∏’π˝“ª∏ˆ∏ﬂµÁ∆Ω
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 9   

 487   1      delayL(1000);//∏ﬂµÁ∆ΩÕπ∆≤ø∑÷
 488   1      PS_CLK = 0;// ±÷”∏ﬂµÁ∆Ω¿≠µÕ
 489   1      delayL(500);//≥÷–¯∞Î∏ˆ÷‹∆⁄
 490   1      PS_DATA = 1;//Ã·«∞∞Î∏ˆ÷–∆⁄∏¯START–≈∫≈
 491   1      delayL(500);//æ≠π˝∞Î∏ˆ÷‹∆⁄£® ±÷”–≈∫≈µƒ £”‡∞Î∏ˆ÷‹∆⁄£©
 492   1      PS_CLK = 1;// ±÷”µ⁄∂˛∏ˆ÷‹∆⁄ø™ º£®¿≠∏ﬂ–≈∫≈◊º±∏¥´ÀÕSTART£©
 493   1      delayL(1000);//æ≠π˝“ª∏ˆ÷‹∆⁄≥÷–¯∏ﬂµÁ∆Ω
 494   1      PS_CLK = 0;//¿≠µÕµÁ∆Ω ±÷””÷æ≠π˝“ª∏ˆ÷‹∆⁄
 495   1      delayL(500);//æ≠π˝∞Î∏ˆ÷‹∆⁄£® ±÷”–≈∫≈µƒ £”‡∞Î∏ˆ÷‹∆⁄£©
 496   1      PS_DATA = 0;// ˝æ›–≈∫≈µÕµÁ∆Ω£¨START∑¢ÀÕÕÍ±œ
 497   1      delayL(500);
 498   1      
 499   1       for(i=0;i<8;i++)
 500   1       {
 501   2       if(bit0o1(dis[0],i)==1)
 502   2       {
 503   3       PS_DATA = 1;// ˝æ›Ω”»Îµ„£®µ⁄“ª◊È£©
 504   3       }
 505   2       else
 506   2       {PS_DATA = 0;}
 507   2       PS_CLK = 1;//¿≠∏ﬂ ±÷”
 508   2       delayL(1000);//æ≠π˝“ª∏ˆ÷‹∆⁄…œ—ÿ 
 509   2       PS_CLK = 0;//¿≠µÕ ±÷”
 510   2       delayL(500);//æ≠π˝∞Î∏ˆ÷‹∆⁄¿≠µÕ ±÷”
 511   2       PS_DATA = 0;//¿≠µÕ ˝æ›–Õ∫≈
 512   2       delayL(500);//µ»¥˝∞Î∏ˆ÷‹∆⁄æ≤»„œ¬8Œª ˝æ›
 513   2       }
 514   1        for(i=0;i<8;i++)
 515   1       {
 516   2       if(bit0o1(dis[1],i)==1)
 517   2       {
 518   3       PS_DATA = 1;// ˝æ›Ω”»Îµ„£®µ⁄“ª◊È£©
 519   3       }
 520   2       else
 521   2       {PS_DATA = 0;}// ˝æ›Ω”»Îµ„£®µ⁄∂˛◊È£©
 522   2       PS_CLK = 1;
 523   2       delayL(1000);
 524   2       PS_CLK = 0;
 525   2       delayL(500);
 526   2       PS_DATA = 0;
 527   2       delayL(500);//µ»¥˝∞Î∏ˆ÷‹∆⁄æ≤»„œ¬8Œª ˝æ›
 528   2       }
 529   1      
 530   1        for(i=0;i<8;i++)
 531   1       {
 532   2       if(bit0o1(dis[2],i)==1)
 533   2       {
 534   3       PS_DATA = 1;// ˝æ›Ω”»Îµ„£®µ⁄“ª◊È£©
 535   3       }
 536   2       else
 537   2       {PS_DATA = 0;}// ˝æ›Ω”»Îµ„£®µ⁄»˝◊È£©
 538   2       PS_CLK = 1;
 539   2       delayL(1000);
 540   2       PS_CLK = 0;
 541   2       delayL(500);
 542   2       PS_DATA = 0;
 543   2       delayL(500);//µ»¥˝∞Î∏ˆ÷‹∆⁄æ≤»„œ¬8Œª ˝æ›
 544   2       }
 545   1      
 546   1      
 547   1        for(i=0;i<8;i++)
 548   1       {
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 10  

 549   2       if(bit0o1(dis[3],i)==1)
 550   2       {
 551   3       PS_DATA = 1;// ˝æ›Ω”»Îµ„£®µ⁄“ª◊È£©
 552   3       }
 553   2       else
 554   2       {PS_DATA = 0;}// ˝æ›Ω”»Îµ„£®µ⁄Àƒ◊È£©
 555   2       PS_CLK = 1;
 556   2       delayL(1000);
 557   2       PS_CLK = 0;
 558   2       delayL(500);
 559   2       PS_DATA = 0;
 560   2        delayL(500);//µ»¥˝∞Î∏ˆ÷‹∆⁄æ≤»„œ¬8Œª ˝æ›
 561   2       }
 562   1      
 563   1      //33
 564   1       PS_DATA = 0;// ˝æ›Ω”»Îµ„33
 565   1       PS_CLK = 1;
 566   1       delayL(1000);
 567   1       PS_CLK = 0;
 568   1       delayL(500);
 569   1       PS_DATA = 0;
 570   1        delayL(500);//µ»¥˝∞Î∏ˆ÷‹∆⁄æ≤»„œ¬8Œª ˝æ›
 571   1      //34
 572   1       PS_DATA = 0;// ˝æ›Ω”»Îµ„34
 573   1       PS_CLK = 1;
 574   1       delayL(1000);
 575   1       PS_CLK = 0;
 576   1       delayL(500);
 577   1       PS_DATA = 0;
 578   1        delayL(500);//µ»¥˝∞Î∏ˆ÷‹∆⁄æ≤»„œ¬8Œª ˝æ›
 579   1      //35
 580   1       PS_CLK = 1;
 581   1       PS_DATA = 1;
 582   1       delayL(1000);
 583   1       PS_CLK = 0;
 584   1       PS_DATA = 1;
 585   1       delayL(500);
 586   1       PS_DATA = 0;
 587   1      //35
 588   1      delayL(5000);
 589   1      PS_CLK = 1; //¡Ωæ‰ª∞“ª∏ˆÕÌ…œ∞°£¨∫¶À¿Œ“¡À°£
 590   1      PS_DATA = 1; 
 591   1      //…œ√Ê÷˜“™“‚Àº «“™∏¥Œª–æ∆¨∏ﬂµÁ∆Ω£¨’‚—˘π‹Ω≈≤≈ª·’˝≥£¥˝ª˙°£
 592   1      } 
 593          
 594          void dis_datLED_PL (char recv)
 595          {
 596   1          uchar temp;
 597   1        dis[3] = 0x73;
 598   1        dis[2] = 0x40;    
 599   1      
 600   1          temp = recv % 10;
 601   1          dis[0] = dis_data[temp];
 602   1          recv=recv/10;
 603   1            temp = recv % 10;
 604   1          dis[1] = dis_data[temp];
 605   1      
 606   1        Display_LED();
 607   1       
 608   1      }
 609          
 610          void dis_datLED_SD ()
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 11  

 611          {
 612   1          uchar temp,u1,u2;
 613   1          //sys_kinds ÷÷¿‡ID
 614   1      
 615   1          u1 = sys_kinds;
 616   1          temp = u1%10;
 617   1          dis[0] = dis_data[temp];
 618   1          u1=u1/10;
 619   1          temp = u1%10;
 620   1          dis[1] = dis_data[temp];
 621   1      
 622   1      
 623   1          u2 = sys_subjects;
 624   1          //sys_subjects ∑÷¿‡ID
 625   1          temp = u2 % 10;
 626   1          dis[2] = dis_data[temp]+0x80;
 627   1      
 628   1      
 629   1          u2=u2/10;
 630   1            temp = u2 % 10;
 631   1          dis[3] = dis_data[temp];
 632   1      
 633   1        Display_LED();
 634   1       
 635   1      }
 636          void clear_system()
 637          {
 638   1          uchar i;
 639   1        /*for(i=0;i<100;i++)
 640   1        {
 641   1          delayL(10000);
 642   1          }
 643   1        ZERO_KEY = 0;
 644   1        ARR_KEY = 0;
 645   1        for(i=0;i<100;i++)
 646   1        {
 647   1          delayL(15000);
 648   1          }
 649   1        ZERO_KEY = 1;
 650   1        ARR_KEY  = 1;
 651   1        */
 652   1        for(i=0;i<100;i++)
 653   1        {
 654   2          delayL(10000);
 655   2        } //¥À¥¶”¶∏√◊∑º”µƒ «Ω¯»Î…Ë∂®ƒ£ Ω£¨ºÏ≤‚…Ë∂®ƒ£ Ωµƒ ˝÷µ£¨÷Æ∫ÛΩ´…Ë∂® ˝÷µ«Â¡„°££®«Â¡„∂Ø◊˜–Ë“™∞¥ZEROº¸£©«Â3000
 656   1          //addorarr_count=3000;
 657   1        //addorarr = 1;
 658   1        Set_press_int();
 659   1        ARR_KEY = 0;
 660   1        for(i=0;i<100;i++)//¥À¥¶—” ±“—æ≠◊∑º”
 661   1        {
 662   2          delayL(10000);
 663   2        }
 664   1        for(i=0;i<100;i++)
 665   1        {
 666   2          delayL(10000);
 667   2        }
 668   1        for(i=0;i<100;i++)
 669   1        {
 670   2          delayL(10000);
 671   2        }
 672   1        for(i=0;i<100;i++)
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 12  

 673   1        {
 674   2          delayL(10000);
 675   2        }
 676   1        for(i=0;i<100;i++)
 677   1        {
 678   2          delayL(10000);
 679   2        }
 680   1        for(i=0;i<100;i++)
 681   1        {
 682   2          delayL(10000);
 683   2        } 
 684   1      
 685   1        ARR_KEY = 1;
 686   1        ZERO_KEY = 0;
 687   1        delayL(20000);
 688   1        delayL(20000);
 689   1        ZERO_KEY = 1;
 690   1        delayL(15000);
 691   1      
 692   1        beep3();//»˝…˘Ã· æ
 693   1      }
 694          void start_system()
 695          {
 696   1          clear_system(); //œµÕ≥“ª¥Œ«Â¡„
 697   1      //  send_usual(0x53);//œµÕ≥◊º±∏ÕÍ±œ£¨œµÕ≥‘⁄œﬂ°£
 698   1      //  send_usual(0x45);//∑¢ÀÕΩÿ÷π∑˚
 699   1      }
 700          
 701           
 702          //≥Ã–Ú÷˜»Îø⁄///////////////////////////////////////////////////////////////-------------------------------
             ---------------------------MAIN
 703          void main(void)
 704          {
 705   1      uint sy = 0;
 706   1        if(sys_status==0)//œµÕ≥◊¥Ã¨Œ™0 ±£¨◊‘∂Ø≥ı ºªØœµÕ≥
 707   1        {
 708   2        init();   //≥ı ºªØ…Ë÷√ /uint i=0;   
 709   2        //≥ı ºªØ÷’∂À0
 710   2        sys_status=77;//µ»¥˝∆Ù∂Ø∞¥º¸  
 711   2        }
 712   1        while(1)
 713   1        { 
 714   2           if(sys_status == 77)
 715   2            {
 716   3             if(PRINT_KEY == 0)
 717   3             {
 718   4              delayL(20000);
 719   4              delayL(20000);
 720   4              delayL(20000);
 721   4              sys_status=17;//Ω¯»Îø™ª˙¬÷—Ø◊¥Ã¨;//Ω¯»ÎœµÕ≥≥ı ºªØ◊¥Ã¨£¨œµÕ≥∆Ù∂Ø
 722   4             }//≈–∂œ∆Ù∂Ø∞¥º¸ «∑Ò∞¥œ¬
 723   3            }
 724   2           if(sys_status==17)
 725   2           {          
 726   3              start_system(); 
 727   3              delayL(20000);
 728   3              delayL(20000);
 729   3              sys_status=18;  
 730   3           }
 731   2           if(sys_status==18)
 732   2           {
 733   3              if(ZERO_KEY == 0)
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 13  

 734   3              {           
 735   4                sys_status=1;
 736   4                sys_res_status=0; 
 737   4              }
 738   3              if(TOTAL_KEY == 0)
 739   3              {
 740   4                sys_status=66;//Ω¯»ÎœµÕ≥Ω” ‹œÓƒø
 741   4                sys_res_status=0;//Ω” ’±Í ∂πÈŒª?
 742   4              }
 743   3            }
 744   2           if(sys_status==66)/////////////////////////////////////////////////////∆¡ƒª«–ªª
 745   2           {
 746   3             clk_test();
 747   3             if(sw_clkchk == 1)
 748   3             {//SW_KEY = 0;
 749   4                SW_LEDP=0;
 750   4                sys_status=4;//Ω¯»ÎœµÕ≥Ω” ‹œÓƒø
 751   4                sys_res_status=0;//Ω” ’±Í ∂πÈŒª°£
 752   4                sw_clkchk = 0;
 753   4                PS_DATA = 0;
 754   4                PS_CLK = 0;
 755   4                delayL(20000);
 756   4                PS_DATA = 1;
 757   4                PS_CLK = 1;
 758   4             }
 759   3           }
 760   2           if(sys_status==4)//—°‘Ò≤¢…Ë∂®≈‰∑ΩID
 761   2           {
 762   3             //EA = 0;//πÿ±’◊‹÷–∂œ
 763   3           //«∞∆⁄«–∂œœ‘ æ∆¡µÁ‘¥“ª¥Œ£¨’˝»∑π©µÁ±‹√‚¬“¬Î    
 764   3           //¥À¥¶÷ª÷¥––“ª¥Œ£¨≤ªº”œﬁ÷∆ª·∑¢…˙∆µ…¡°£
 765   3           delayL(20000);
 766   3           delayL(20000);
 767   3           delayL(20000);
 768   3           delayL(20000);
 769   3           clk_test(); //////////////////////////////////////////////////////////////////œ‘ æ«–ªª
 770   3           SW_LED=0;//¥À ±«–ªªœ‘ æ∆˜     œ»«–ªª‘Ÿ∑¢ÀÕ
 771   3           sw_clkchk = 0;
 772   3      
 773   3           if(sw_one == 0)
 774   3           {
 775   4           SW_LEDP=0;
 776   4           delayL(20000);//πÿ±’—” ± ±º‰°£
 777   4           delayL(20000);//πÿ±’—” ± ±º‰°£
 778   4           delayL(20000);//πÿ±’—” ± ±º‰°£
 779   4           delayL(20000);//πÿ±’—” ± ±º‰°£
 780   4           delayL(20000);//πÿ±’—” ± ±º‰°£
 781   4           delayL(20000);//πÿ±’—” ± ±º‰°£
 782   4           delayL(20000);//πÿ±’—” ± ±º‰°£
 783   4           SW_LEDP=1;
 784   4           delayL(2000);     
 785   4           sw_one++;  
 786   4           }   
 787   3             if(ARR_KEY==1)
 788   3           {
 789   4             sys_subjects++;
 790   4             if(sys_subjects>=20){sys_subjects=20;}
 791   4             delayL(60000);
 792   4           }
 793   3           if(ADD_KEY==1) 
 794   3             {
 795   4             sys_subjects--;
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 14  

 796   4             if(sys_subjects<1){sys_subjects=1;}
 797   4             delayL(60000);
 798   4           }
 799   3             //dis_counter_uSvhr(sys_subjects);
 800   3           dis_datLED_PL(sys_subjects);
 801   3      
 802   3           if(PRINT_KEY==0) //∞¥»∑»œ∞¥º¸∫ÛΩ¯»Î≈‰∑Ω∑¢ÀÕƒ£ Ω
 803   3           {  
 804   4             delayL(60000);
 805   4             //sys_status=99;
 806   4              dis[3] = 0x40;
 807   4            dis[0] = 0x40;
 808   4            dis[2] = 0x3F;
 809   4            dis[1] = 0x3F;
 810   4            Display_LED();
 811   4            sw_one = 0;
 812   4            delayL(20000);
 813   4            delayL(20000);
 814   4            delayL(20000);
 815   4            delayL(20000);
 816   4            delayL(20000);
 817   4            delayL(20000);
 818   4             sys_status = 1;
 819   4             sys_res_status=16;
 820   4             sys_kinds = 1;
 821   4             WLID = sys_kinds;
 822   4             PFID = sys_subjects;
 823   4            //EA = 1;//ø™∆Ù◊‹÷–∂œ
 824   4           }
 825   3           }
 826   2      
 827   2          if(sys_status==1)//”Î—°‘Ò≈‰∑Ω ˝æ›Ω” ’¥¶¿Ì
 828   2           {     
 829   3           //∑¢ÀÕÀ˘—°‘Òµƒ≈‰∑Ω÷÷¿‡
 830   3           if(sys_res_status==0)//»Áπ˚Œ¥Ω” ’µΩœ¬Ãı ˝æ›‘Ú“ª÷±∑¢ÀÕ
 831   3           {
 832   4             
 833   4             if(tick == 0)
 834   4            {   
 835   5                  //intko=0;
 836   5                send_usual(0x01);//∑¢ÀÕÕ®—∂±Í ∂
 837   5             //send(sys_subjects);//∑¢ÀÕ≈‰∑ΩID ASCII //¥À¥¶±‰ªª≥…¡ΩŒª’˚ ˝£ø£ø£ø£ø£ø
 838   5             //¬÷—Ø∑¢ÀÕ ˝æ›
 839   5                send_usual(0x01);
 840   5                send_usual(0x04);
 841   5                send_usual(0x04);
 842   5                send_usual(0x04);
 843   5                send_usual(0x04);
 844   5                send_usual(0x0d);         
 845   5                //∑¢ÀÕΩÿ÷π∑˚
 846   5              }
 847   4             if(tick == 1)
 848   4             {
 849   5               intko=0;
 850   5             if(sys_res_status==0)
 851   5               {send_usual(0x4a);}//±‰ªª∑¢J
 852   5             {send_usual(0x45);}//±‰ªª∑¢E
 853   5             {send_usual(0x45);}//±‰ªª∑¢E
 854   5             {send_usual(0x45);}//±‰ªª∑¢E
 855   5             {send_usual(0x45);}//±‰ªª∑¢E
 856   5             {send_usual(0x45);}//±‰ªª∑¢E
 857   5             {send_usual(0x45);}//±‰ªª∑¢E
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 15  

 858   5             {send_usual(0x45);}//±‰ªª∑¢E
 859   5             }
 860   4                  
 861   4             //send_usual(0x0A);//ªª––∑˚
 862   4             delayL(20000);//—” ±µ˜’˚£¨µ»¥˝º∆À„ª˙ªÿ¿°
 863   4             delayL(20000);
 864   4             delayL(20000);
 865   4             delayL(20000);
 866   4             delayL(20000);
 867   4             delayL(20000);
 868   4             delayL(20000);
 869   4             delayL(20000);
 870   4             delayL(20000);
 871   4             delayL(20000);
 872   4             delayL(20000);
 873   4             delayL(20000);
 874   4             delayL(20000);
 875   4             delayL(20000);
 876   4             delayL(20000);
 877   4             delayL(20000);
 878   4             delayL(20000);
 879   4             delayL(20000);
 880   4             delayL(20000);
 881   4             delayL(20000);
 882   4             delayL(20000);
 883   4                   delayL(20000);//—” ±µ˜’˚£¨µ»¥˝º∆À„ª˙ªÿ¿°
 884   4             delayL(20000);
 885   4             delayL(20000);
 886   4             delayL(20000);
 887   4             delayL(20000);
 888   4             delayL(20000);
 889   4             delayL(20000);
 890   4             delayL(20000);
 891   4             delayL(20000);
 892   4             delayL(20000);
 893   4             delayL(20000);
 894   4             delayL(20000);
 895   4             delayL(20000);
 896   4             delayL(20000);
 897   4             delayL(20000);
 898   4             delayL(20000);
 899   4             delayL(20000);
 900   4             delayL(20000);
 901   4             delayL(20000);
 902   4             delayL(20000);
 903   4             delayL(20000);
 904   4                   delayL(20000);//—” ±µ˜’˚£¨µ»¥˝º∆À„ª˙ªÿ¿°
 905   4             delayL(20000);
 906   4             delayL(20000);
 907   4             delayL(20000);
 908   4             delayL(20000);
 909   4             delayL(20000);
 910   4             delayL(20000);
 911   4             delayL(20000);
 912   4             delayL(20000);
 913   4             delayL(20000);
 914   4             delayL(20000);
 915   4             delayL(20000);
 916   4             delayL(20000);
 917   4             delayL(20000);
 918   4             delayL(20000);
 919   4             delayL(20000);
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 16  

 920   4             delayL(20000);
 921   4             delayL(20000);
 922   4             delayL(20000);
 923   4             delayL(20000);
 924   4             delayL(20000);
 925   4                   delayL(20000);//—” ±µ˜’˚£¨µ»¥˝º∆À„ª˙ªÿ¿°
 926   4             delayL(20000);
 927   4             delayL(20000);
 928   4             delayL(20000);
 929   4             delayL(20000);
 930   4             delayL(20000);
 931   4             delayL(20000);
 932   4             delayL(20000);
 933   4             delayL(20000);
 934   4             delayL(20000);
 935   4             delayL(20000);
 936   4             delayL(20000);
 937   4             delayL(20000);
 938   4             delayL(20000);
 939   4             delayL(20000);
 940   4             delayL(20000);
 941   4             delayL(20000);
 942   4             delayL(20000);
 943   4             delayL(20000);
 944   4             delayL(20000);
 945   4             delayL(20000);
 946   4      
 947   4           }
 948   3      
 949   3      
 950   3           if(sys_res_status==1)//Ω” ’µΩ ˝æ›÷Æ∫ÛΩ¯––’˚ÃÂ ˝æ›Ω” ’¥˝ª˙
 951   3            {
 952   4              SW_LED=0;
 953   4              dis[3] = 0x40;
 954   4              dis[0] = 0x40;
 955   4              dis[2] = 0x3F;
 956   4              dis[1] = 0x38;
 957   4              Display_LED();
 958   4              //«Â≥˝Ω” ’ª∫≥Â«¯
 959   4              recv_buf[0]=0x00;
 960   4              recv_buf[1]=0x00;
 961   4              recv_buf[2]=0x00;
 962   4              recv_buf[3]=0x00;
 963   4              recv_buf[4]=0x00;
 964   4              recv_buf[5]=0x00;
 965   4              recv_buf[6]=0x00;
 966   4      
 967   4              sys_res_status = 44;
 968   4              key_zero = 0;
 969   4            }
 970   3           if(sys_res_status==44&&key_zero == 2)//Ω¯»Î¬÷—µΩ” ’¥˝ª˙◊¥Ã¨ //EEPRROM xieru
 971   3            {
 972   4                 //∂‘”¶EEPROM¥Ê¥¢
 973   4              WLID = recv_buf[2]; 
 974   4              PFID = recv_buf[1]; 
 975   4              
 976   4              
 977   4              if(WLID == 0x01)//»Áπ˚ŒÔ¡œIDŒ™µ⁄“ªŒªµƒ ±∫Ú ◊œ»÷¥––…»«¯«Â¡„∂Ø◊˜
 978   4               {
 979   5                SectorErase(0x58+(PFID*2),0x00);//–¥»Î«∞“™«Â…»«
 980   5                 delayL(20000);
 981   5                 delayL(20000);
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 17  

 982   5                byte_write(recv_buf[3],0x58+(PFID*2),(WLID*2));//∏¸–¬EEPROM ∏ﬂŒª
 983   5                  delayL(20000);                
 984   5                byte_write(recv_buf[4],0x58+(PFID*2),(WLID*2)+1);//∏¸–¬EEPROM µÕŒª
 985   5                delayL(20000);
 986   5                 //–¥»Î∂‘”¶≈‰∑ΩŒÔ¡œ ˝¡ø
 987   5      
 988   5                //byte_read(0x58+(PFID*2),(WLID*2))          
 989   5               }
 990   4                 else
 991   4               {
 992   5                byte_write(recv_buf[3],0x58+(PFID*2),(WLID*2));//∏¸–¬EEPROM ∏ﬂŒª
 993   5                delayL(20000);
 994   5                byte_write(recv_buf[4],0x58+(PFID*2),(WLID*2)+1);//∏¸–¬EEPROM µÕŒª
 995   5                delayL(20000);       
 996   5               }
 997   4               delayL(20000);
 998   4               delayL(20000);
 999   4               delayL(20000);
1000   4               delayL(20000);
1001   4               //∑µÀÕΩ·π˚
1002   4                send_usual(recv_buf[0]);
1003   4                send_usual(recv_buf[1]);
1004   4                send_usual(recv_buf[2]);
1005   4                send_usual(byte_read(0x58+(PFID*2),(WLID*2)));
1006   4                send_usual(byte_read(0x58+(PFID*2),(WLID*2)+1));
1007   4      //          send_usual(recv_buf[3]);
1008   4      //          send_usual(recv_buf[4]);
1009   4                send_usual(recv_buf[5]);
1010   4                send_usual(recv_buf[6]);
1011   4                if(recv_buf[5] == 0xFA)//»Áπ˚ŒÔ¡œ“—æ≠∑¢ÀÕÕÍ±œÕÀ≥ˆµΩ¥˝ª˙◊¥Ã¨
1012   4                {             
1013   5                  sys_status=66;
1014   5                }
1015   4                else
1016   4                {
1017   5                  PF[0] = recv_buf[5];
1018   5                  byte_write(0x46,recv_buf[5],PFID);//∏¸–¬EEPROM  µÕŒª
1019   5                }
1020   4      
1021   4      
1022   4                //«Â≥˝Ω” ’ª∫≥Â«¯
1023   4                recv_buf[0]=0x00;
1024   4                recv_buf[1]=0x00;
1025   4                recv_buf[2]=0x00;
1026   4                recv_buf[3]=0x00;
1027   4                recv_buf[4]=0x00;
1028   4                recv_buf[5]=0x00;
1029   4                recv_buf[6]=0x00;
1030   4                WLID = 0x00;
1031   4                PFID = 0x00;
1032   4                key_zero = 0;
1033   4      
1034   4               
1035   4            }
1036   3            
1037   3      
1038   3      
1039   3      
1040   3      
1041   3           if(sys_res_status==16)
1042   3            {
1043   4              ES=0;//Ω˚÷π¥Æ––÷–∂œ///////////////////////////////////////////////////////////πÿ÷–∂œ 
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 18  

1044   4              delayL(15000);        
1045   4              delayL(400);//3.15
1046   4              recv_data();
1047   4              delayL(20000);
1048   4              delayL(20000);
1049   4              delayL(20000);
1050   4              delayL(20000);
1051   4              delayL(20000);
1052   4              delayL(20000);
1053   4              delayL(20000);        
1054   4                delayL(20000);
1055   4              delayL(20000);
1056   4              delayL(20000);
1057   4              delayL(20000);
1058   4           if(sw_one == 0)
1059   4           {
1060   5           SW_LEDP=0;
1061   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1062   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1063   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1064   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1065   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1066   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1067   5           SW_LEDP=1;
1068   5           delayL(2000);
1069   5           sw_one++;
1070   5           }
1071   4              SW_LED=0;//¥À ±«–ªªœ‘ æ∆˜ø™
1072   4              delayL(15000);
1073   4              delayL(20000);
1074   4              delayL(20000);
1075   4              dis_datLED_SD ();//xianshi
1076   4              delayL(20000);
1077   4              delayL(20000);
1078   4              delayL(20000);
1079   4              delayL(20000);
1080   4              dis_datLED_SD ();
1081   4                      delayL(20000);
1082   4              delayL(20000);
1083   4                      delayL(20000);
1084   4              delayL(20000);
1085   4              DOT_LED = 0;//œ‘ æ–° ˝µ„∂˘
1086   4                     
1087   4              //¥À¥¶œ‘ æ∏¸–¬ŒÔ¡œ÷÷¿‡£¨ŒÔ¡œIDπ©»∑»œ
1088   4              sys_kind_temp = sys_kinds;
1089   4            if(PRINT_KEY==0)
1090   4            {
1091   5              if(ARR_KEY==0)
1092   5              {DOT_LED = 1;
1093   6              dis[3] = 0x40;
1094   6              dis[0] = 0x40;
1095   6              dis[2] = 0x3F;
1096   6              dis[1] = 0x38;
1097   6              Display_LED();
1098   6              delayL(20000);
1099   6              delayL(20000);
1100   6              delayL(20000);
1101   6              Display_LED();
1102   6              delayL(20000);
1103   6              delayL(20000);
1104   6              Display_LED();
1105   6              delayL(20000);
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 19  

1106   6              sw_one = 0;
1107   6              sys_res_status=3;
1108   6              }
1109   5             }
1110   4            } 
1111   3            if(sys_res_status == 3)//»∑»œID∫Û //////////////////////////////////////////////¥À¥¶∞¥º¸…Ë∂®Œª÷√°£
1112   3             {       
1113   4             delayL(20000);
1114   4             delayL(20000);
1115   4             delayL(20000);
1116   4             delayL(20000);
1117   4             delayL(20000);
1118   4             delayL(20000);
1119   4             clk_test(); //////////////////////////////////////////////////////////////////œ‘ æ«–ªª
1120   4             SW_LED=1;//¥À ±«–ªªœ‘ æ∆˜
1121   4             sw_clkchk = 0;
1122   4               SW_LEDP=0;
1123   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1124   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1125   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1126   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1127   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1128   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1129   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1130   4           //SW_LEDP=1;
1131   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1132   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1133   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1134   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1135   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1136   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1137   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1138   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1139   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1140   4           delayL(20000);//πÿ±’—” ± ±º‰
1141   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1142   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1143   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1144   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1145   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1146   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1147   4           SW_LEDP=0;
1148   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1149   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1150   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1151   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1152   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1153   4           SW_LEDP=1;
1154   4           delayL(2000);
1155   4             delayL(20000);
1156   4             delayL(20000);
1157   4             delayL(20000);
1158   4             delayL(20000);
1159   4               Set_press_int();//…Ë∂®÷ÿ¡ø
1160   4             sys_status=9; //∑¢ÀÕ»∑»œ±Í ∂»∑∂®…Ë∂®∫√÷ÿ¡ø≤¢ø™ ºº∆¡ø
1161   4             delayL(20000);
1162   4             delayL(20000);
1163   4             delayL(20000);
1164   4             delayL(20000);
1165   4             delayL(20000);
1166   4             }     
1167   3          }
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 20  

1168   2      
1169   2      
1170   2      
1171   2           if(sys_status == 7)
1172   2           {
1173   3            //dis_data_led(00003);//ALL
1174   3            dis[3] = 0x40;
1175   3            dis[0] = 0x40;
1176   3            dis[2] = 0x77;
1177   3            dis[1] = 0x38;
1178   3            Display_LED();
1179   3               //TOTAL_KEY=0;
1180   3               //delayL(20000);
1181   3               //delayL(20000);
1182   3               //TOTAL_KEY=1;
1183   3            //sys_res_status = 0;//∆Ù∂Ø≈‰∑Ωµ»¥˝∂Ø◊˜
1184   3            //sys_status = 4;
1185   3            if(PRINT_KEY == 0)
1186   3            {SW_LEDP=0;}
1187   3            else{SW_LEDP=1;}
1188   3            delayL(20000);
1189   3            delayL(20000);
1190   3            delayL(20000);
1191   3            delayL(20000);
1192   3            delayL(20000);
1193   3            delayL(20000);
1194   3            delayL(20000);
1195   3            delayL(20000);
1196   3            delayL(20000);
1197   3            delayL(20000);
1198   3            delayL(20000);
1199   3            delayL(20000);
1200   3            delayL(20000);
1201   3            delayL(20000);
1202   3            delayL(20000);
1203   3            delayL(20000);
1204   3            delayL(20000);
1205   3           if(sw_one == 0)
1206   3           {
1207   4           SW_LEDP=0;
1208   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1209   4           delayL(20000);
1210   4           delayL(20000);
1211   4           delayL(20000);
1212   4               delayL(20000);
1213   4           delayL(20000);
1214   4           delayL(20000);
1215   4               delayL(20000);
1216   4           delayL(20000);
1217   4           delayL(20000);
1218   4            clk_test(); //////////////////////////////////////////////////////////////////œ‘ æ«–ªª
1219   4             SW_LED=1;//¥À ±«–ªªœ‘ æ∆˜
1220   4             sw_clkchk = 0;
1221   4                //SW_LED=1;//«–ªªµΩœ‘ æ∆˜£¨Œﬁœﬁ—≠ª∑
1222   4           SW_LEDP=1;
1223   4           delayL(2000);
1224   4           sw_one++;
1225   4           }
1226   3            ES=0;//Ω˚÷π¥Æ––÷–∂œ///////////////////////////////////////////////////////////πÿ÷–∂œ 
1227   3            delayL(20000);
1228   3           }
1229   2      
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 21  

1230   2           if(sys_status == 9)
1231   2           {
1232   3               delayL(20000);
1233   3               delayL(20000);
1234   3               //send_usual(0x4f);//Ω· ¯±Í æ∑˚
1235   3               delayL(40000);//Zero∞¥º¸ø™ ºº¡¡ø≤¢Ω¯»Îº‡øÿƒ£ Ω
1236   3               ZERO_KEY=0;
1237   3               delayL(40000);
1238   3               ZERO_KEY=1;
1239   3               sys_status=2;
1240   3                       delayL(20000);
1241   3               delayL(20000);
1242   3                       delayL(20000);
1243   3               delayL(20000);
1244   3                       delayL(20000);
1245   3               delayL(20000);
1246   3                       delayL(20000);
1247   3               delayL(20000);
1248   3                       delayL(20000);
1249   3               delayL(20000);
1250   3                       delayL(20000);
1251   3               delayL(20000);
1252   3                       delayL(20000);
1253   3               delayL(20000);
1254   3                       
1255   3           }
1256   2             if(sys_status == 13)
1257   2           {//Ω” ’¥ÌŒÛ
1258   3            dis[3] = 0x50;
1259   3            dis[0] = 0x40;
1260   3            dis[2] = 0x79;
1261   3            dis[1] = 0x50;
1262   3            Display_LED();
1263   3            sys_status = 0;
1264   3            delayL(20000);
1265   3            delayL(20000);
1266   3            delayL(20000);
1267   3            delayL(20000);
1268   3            delayL(20000);
1269   3            delayL(20000);
1270   3           }
1271   2             if(sys_status==2)// ˝æ›º‡øÿ¥¶¿Ì
1272   2              {
1273   3               //beep3();
1274   3               ReadPS2();
1275   3               Code2char();
1276   3               delayL(20000);
1277   3            delayL(20000);
1278   3            delayL(20000);
1279   3            delayL(20000);
1280   3            delayL(20000);
1281   3            delayL(20000);
1282   3            //‘⁄¥À¥¶◊∑º”◊‘∂Ø∑¢ÀÕJµƒΩ· ¯¥¶¿Ì◊¥Ã¨£¨≤¢«Â≥˝ºº ıœµÕ≥µƒ¡Ÿ ±±£¥Ê÷µ°£“‘±„œ¬¥ŒºÃ–¯’˝»∑≈‰¡œ°£
1283   3            //if(fu_hao == -0x05)//‘⁄ ∞»° ˝◊÷≤ªŒ™0∫Õ∏∫ ˝µƒ ±∫Ú£¨OKID¡¢º¥«Â¡„°£
1284   3            //{ok_id=0;}
1285   3            //if(cvover!=0)
1286   3            //{ok_id=0;}
1287   3            if(ok_id ==0 && ok_id2 == 0)//’‚∏ˆµÿ∑Ω”–Œ Ã‚
1288   3            {time0_tick = 0;}
1289   3            if(ok_id == 1||ok_id2 == 1)//µ±OK_ID¥Û”⁄0µƒ ±∫Ú÷§√˜œµÕ≥“—æ≠“ª¥ŒΩ¯»Î0µƒ◊¥Ã¨£¨÷§√˜º”¡œ“—æ≠µΩ¥Ôπ˝µ◊œﬂ£¨
             -’‚—˘æÕ–Ë“™Ω¯»Î¥¶¿Ìª˙÷∆°£
1290   3            {
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 22  

1291   4              time0_tick++;//Ω” ’µΩ±Í ∂◊‘∂Ø‘ˆº” ˝◊÷“‘±„—” ±‘Ωπ˝œµÕ≥Ω¯»ÎTOTAL◊‘∂Ø∑¢ÀÕJ
1292   4              //delayL(20000);
1293   4              //delayL(20000);
1294   4              //delayL(20000);
1295   4              //delayL(20000);
1296   4              //delayL(20000);
1297   4              //if(ok_id>2) //—” ±ø™πÿ£¨—” ±∂‡…Ÿ¥Œ∫Ûø…“‘÷¥––◊Ó÷’≤Ÿ◊˜
1298   4              //{
1299   4              if(time0_tick>4)
1300   4               {
1301   5                 time0_tick=0;
1302   5                 ok_id=0;//»Áπ˚—” ±¥À ˝¥ÔµΩ¥À ±–Ë“™∏¥ŒªOK_ID“‘±„œ¬¥ŒΩ¯»Î°£
1303   5                 ok_id2=0;
1304   5               //sys_press_temp=0;//œµÕ≥TEMPæØ±®º∆ ˝«Â¡„    –ﬁ’˝‘≠“Ú£¨–¬∞Ê±æ≤ª–Ë“™«Â¡„
1305   5        if(fu_hao==-0x03)
1306   5        {cvover = cvover+(byte_read(0x58+(PFID*2),(WLID*2)))*256+byte_read(0x58+(PFID*2),(WLID*2)+1);}
1307   5        else{cvover = (byte_read(0x58+(PFID*2),(WLID*2)))*256+byte_read(0x58+(PFID*2),(WLID*2)+1)-cvover;}
1308   5      //  send_usual(0x45);//∑¢ÀÕΩÿ÷π∑˚
1309   5      
1310   5              if(WLID == 0x01)//»Áπ˚ŒÔ¡œIDŒ™µ⁄“ªŒªµƒ ±∫Ú ◊œ»÷¥––…»«¯«Â¡„∂Ø◊˜
1311   5               {
1312   6                SectorErase(0x48+(PFID*2),0x00);//–¥»Î«∞“™«Â…»?
1313   6                 delayL(20000);
1314   6                 delayL(20000);
1315   6                byte_write((cvover/256),0x48+(PFID*2),(WLID*2));//∏¸–¬EEPROM  ∏ﬂŒª
1316   6                 delayL(20000);               
1317   6                byte_write((cvover%256),0x48+(PFID*2),(WLID*2)+1);//∏¸–¬EEPROM  µÕŒª
1318   6                delayL(20000);
1319   6      
1320   6                //byte_read(0x58+(PFID*2),(WLID*2))          
1321   6               }
1322   5                 else
1323   5               {
1324   6                byte_write((cvover/256),0x48+(PFID*2),(WLID*2));//∏¸–¬EEPROM  ∏ﬂŒª
1325   6                delayL(20000);
1326   6                byte_write((cvover%256),0x48+(PFID*2),(WLID*2)+1);//∏¸–¬EEPROM  µÕŒª
1327   6                delayL(20000);       
1328   6               }
1329   5               delayL(20000);
1330   5               delayL(20000);
1331   5               delayL(20000);
1332   5               delayL(20000);
1333   5               //◊‘∂Ø∑¢ÀÕJΩ¯»Î∑¢ÀÕ◊¥Ã¨µƒSYS_STATUS.
1334   5               //¥À¥¶Œ™¡À ° ¬∂˘£¨∏¥÷∆“ªœ¬∞¥º¸◊¥Ã¨
1335   5               sys_res_status=0;
1336   5               sys_status=1;
1337   5               delayL(20000);
1338   5                 delayL(20000);
1339   5                 delayL(20000);
1340   5                 delayL(20000);
1341   5                 delayL(20000);
1342   5                   SW_LEDP=0;
1343   5            clk_test(); //////////////////////////////////////////////////////////////////œ‘ æ«–ªª
1344   5             SW_LED=0;//¥À ±«–ªªœ‘ æ∆˜
1345   5             sw_clkchk = 0;
1346   5           //SW_LED=0;
1347   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1348   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1349   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1350   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1351   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1352   5           SW_LEDP=1;
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 23  

1353   5               
1354   5               
1355   5                         
1356   5           /*SW_LEDP=0;    
1357   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1358   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1359   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1360   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1361   5           delayL(20000);//πÿ±’—” ± ±º‰°£
1362   5            clk_test(); //////////////////////////////////////////////////////////////////œ‘ æ«–ªª
1363   5             SW_LED=0;//¥À ±«–ªªœ‘ æ∆˜
1364   5             sw_clkchk = 0;
1365   5           //SW_LED=0;
1366   5           SW_LEDP=1;*/
1367   5                 delayL(2000);
1368   5                 delayL(20000);
1369   5                 delayL(20000);
1370   5                 delayL(20000);
1371   5                 delayL(20000);
1372   5                 delayL(20000);
1373   5                 delayL(20000);
1374   5                 delayL(20000);
1375   5                 delayL(20000);
1376   5                 delayL(20000);
1377   5                 delayL(20000);
1378   5                 //send_usual(0x4a);
1379   5               tick=1;
1380   5              dis[3] = 0x40;
1381   5              dis[0] = 0x40;
1382   5              dis[2] = 0x3F;
1383   5              dis[1] = 0x3F;
1384   5              Display_LED();
1385   5              delayL(20000);
1386   5              delayL(20000);
1387   5              delayL(20000);
1388   5              delayL(20000);
1389   5              delayL(20000);
1390   5              delayL(20000);
1391   5              ES=1;//ø™∆Ù¥Æ––÷–∂œ//////////////////////////////////////////////////////////////ø™÷–∂œ
1392   5               //¥À¥¶”¶œ‘ æ»∑»œª≠√Ê
1393   5              delayL(20000);
1394   5              //«Â¿Ìº∆ ˝∆˜
1395   5              delayL(20000);
1396   5              delayL(20000);
1397   5              delayL(20000);
1398   5              delayL(20000);
1399   5              delayL(20000);
1400   5              delayL(20000);
1401   5              delayL(20000);
1402   5              delayL(20000);        
1403   5              }
1404   4            
1405   4            }
1406   3      
1407   3      
1408   3      
1409   3               //key_scan();
1410   3             if(PRINT_KEY==0&&ADD_KEY==0) //∞¥»∑»œ∞¥º¸∫ÛΩ¯»Î≈‰∑Ω∑¢ÀÕƒ£ Ω
1411   3              {
1412   4             sys_res_status=0;
1413   4             sys_status=1;
1414   4             delayL(20000);
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 24  

1415   4               delayL(20000);
1416   4             delayL(20000);
1417   4               delayL(20000);
1418   4               delayL(20000);
1419   4               delayL(20000);        
1420   4           SW_LEDP=0;
1421   4            clk_test(); //////////////////////////////////////////////////////////////////œ‘ æ«–ªª
1422   4             SW_LED=0;//¥À ±«–ªªœ‘ æ∆˜
1423   4             sw_clkchk = 0;
1424   4           //SW_LED=0;
1425   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1426   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1427   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1428   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1429   4           delayL(20000);//πÿ±’—” ± ±º‰°£
1430   4           SW_LEDP=1;
1431   4           delayL(2000);
1432   4             delayL(20000);
1433   4               delayL(20000);
1434   4               delayL(20000);
1435   4               delayL(20000);
1436   4               delayL(20000);
1437   4                     delayL(20000);
1438   4               delayL(20000);
1439   4               delayL(20000);
1440   4               delayL(20000);
1441   4                     delayL(20000);
1442   4               delayL(20000);
1443   4               delayL(20000);
1444   4               delayL(20000);
1445   4                     delayL(20000);
1446   4               delayL(20000);
1447   4               delayL(20000);
1448   4               delayL(20000);
1449   4                     delayL(20000);
1450   4               delayL(20000);
1451   4               delayL(20000);
1452   4               delayL(20000);
1453   4                     delayL(20000);
1454   4               delayL(20000);
1455   4               delayL(20000);
1456   4               delayL(20000);
1457   4                     delayL(20000);
1458   4               delayL(20000);
1459   4               delayL(20000);
1460   4               delayL(20000);
1461   4               //send_usual(0x4a);
1462   4             tick=1;
1463   4              dis[3] = 0x40;
1464   4              dis[0] = 0x40;
1465   4              dis[2] = 0x3F;
1466   4              dis[1] = 0x3F;
1467   4              Display_LED();
1468   4              delayL(20000);
1469   4              delayL(20000);
1470   4              delayL(20000);
1471   4              delayL(20000);
1472   4              delayL(20000);
1473   4              delayL(20000);        
1474   4               //¥À¥¶”¶œ‘ æ»∑»œª≠√Ê
1475   4              delayL(20000);
1476   4              //«Â¿Ìº∆ ˝∆˜
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 25  

1477   4              delayL(20000);
1478   4              delayL(20000);
1479   4              delayL(20000);
1480   4              delayL(20000);
1481   4              delayL(20000);
1482   4              delayL(20000);
1483   4              delayL(20000);
1484   4              //∞¥TOTAL«Â¿ÌæØ±®
1485   4              //TOTAL_KEY = ; 
1486   4               //SW_KEY = 0;//πÿ±’º¸≈Ã
1487   4               delayL(20000);//Zero∞¥º¸ø™ ºº¡¡ø≤¢Ω¯»Îº‡øÿƒ£ Ω
1488   4               delayL(20000);
1489   4               delayL(20000);//Zero∞¥º¸ø™ ºº¡¡ø≤¢Ω¯»Îº‡øÿƒ£ Ω
1490   4               delayL(20000);
1491   4               delayL(20000);//Zero∞¥º¸ø™ ºº¡¡ø≤¢Ω¯»Îº‡øÿƒ£ Ω
1492   4               delayL(20000);
1493   4                 delayL(20000);//Zero∞¥º¸ø™ ºº¡¡ø≤¢Ω¯»Îº‡øÿƒ£ Ω
1494   4               delayL(20000);
1495   4               //while(PRINT_KEY==0){;}
1496   4               //SW_KEY = 0;//¥Úø™º¸≈Ã
1497   4               TOTAL_KEY=0;
1498   4               delayL(20000);
1499   4               delayL(20000);
1500   4               delayL(20000);
1501   4               delayL(20000);
1502   4               TOTAL_KEY=0;
1503   4               delayL(20000);
1504   4               delayL(20000);
1505   4               TOTAL_KEY=1;
1506   4               delayL(20000);
1507   4               delayL(20000);
1508   4               delayL(20000);
1509   4               delayL(20000);
1510   4               //TOTAL_KEY=1;
1511   4               //
1512   4               ES=1;//ø™∆Ù¥Æ––÷–∂œ//////////////////////////////////////////////////////////////ø™÷–∂œ     
1513   4             }
1514   3              }
1515   2      
1516   2        }
1517   1      }
1518          //≥ı ºªØ◊‹∫Ø ˝////////////////////////////////////////////////////////////
1519          void init()
1520          {
1521   1        init_CPU();   //≥ı ºªØCPU…Ë÷√
1522   1        LCD_init();   //LCD≥ı ºªØ…Ë÷√
1523   1        init_uart();
1524   1        P26=0;
1525   1      }
1526          
1527          //CPU≥ı ºªØ∫Ø ˝///////////////////////////////////////////////////////////
1528          void init_CPU()
1529          {
1530   1        EA = 1;     //ø™CPU÷–∂œ
1531   1        CLK_DIV = 0x00; //æß’Ò≤ª∑÷∆µ 20Mƒ¨»œ
1532   1        //P1M0=1;
1533   1        //P1M1=0;
1534   1        //init_TIMER();//∂® ±∆˜≥ı ºªØ°£
1535   1      }
1536          
1537          //—” ±∫Ø ˝/////////—” ± ±º‰◊‘º∫º∆À„///////////////////////////////////////
1538          void delayL(uint n)
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 26  

1539          {
1540   1        uchar i;
1541   1        while(n>0)
1542   1        {
1543   2          for(i=10;i>2;i--);
1544   2          n--;
1545   2        } 
1546   1      }
1547          
1548          //∂® ±∆˜≥ı ºªØ∫Ø ˝£®Œ¥ π”√£©/////////////////////////////////////////////
1549          void init_TIMER()
1550          {
1551   1      EA = 0;
1552   1      TR0 = 0;
1553   1      TMOD = 0x01;
1554   1        TH0 = (65536-10000)/256;        //∂® ±∆˜0ºƒ¥Ê∆˜≥ı÷µ∏ﬂ8Œª
1555   1        TL0 = (65536-10000)%256;        //∂® ±∆˜0ºƒ¥Ê∆˜≥ı÷µµÕ8Œª
1556   1        PT0 = 1;
1557   1        ET0 = 1;
1558   1        EA = 1; 
1559   1      }
1560          
1561          
1562          /****≥ı ºªØ∫Ø ˝end****/
1563          void Serial_Int(void) interrupt 4 using 1
1564          {
1565   1              ES = 0;
1566   1              if(RI == 1)   //µ±”≤º˛Ω” ’µΩ“ª∏ˆ ˝æ› ±£¨RIª·÷√Œª
1567   1              {
1568   2                if(SBUF == 0x0A&&intko == 0)//÷ª“™”ˆµΩTæÕ÷√0 ¥”0ø™ ºº∆ ˝£¨’‚∏ˆŒ™¡À∂¡»°º∆À„ª˙∑¢ÀÕµƒŒÔ¡œ ˝æ›◊º»∑
1569   2                {
1570   3                     key_zero = 1;
1571   3                     sd_kind = 2;               
1572   3                }
1573   2                if(SBUF == 0x01&&intko == 0)//÷ª“™”ˆµΩTæÕ÷√0 ¥”0ø™ ºº∆ ˝£¨’‚∏ˆŒ™¡À∂¡»°º∆À„ª˙∑¢ÀÕµƒŒÔ¡œ ˝æ›◊º»∑
1574   2                {
1575   3                     key_zero = 1;
1576   3                     sd_kind = 1;                       
1577   3                }
1578   2                if(SBUF == 0x03&&intko == 0)//÷ª“™”ˆµΩTæÕ÷√0 ¥”0ø™ ºº∆ ˝£¨’‚∏ˆŒ™¡À∂¡»°º∆À„ª˙∑¢ÀÕµƒŒÔ¡œ ˝æ›◊º»∑
1579   2                {
1580   3                     key_zero = 1;
1581   3                     sd_kind = 3;                       
1582   3                }
1583   2                recv_buf[intko] = SBUF;                //∞—¥”¥Æø⁄∂¡≥ˆµƒ ˝¥ÊµΩ ˝◊È
1584   2                      RI = 0;                 
1585   2                      if(intko == 6)
1586   2                      {
1587   3                         if(recv_buf[6] == 0x0d)  
1588   3                            {         
1589   4                              intko = 0;
1590   4                              key_zero = 2;                //»∑»œ ’µΩ◊÷∑˚¥Æ
1591   4                              if(sd_kind == 1&&sys_status==1)//ƒ£ Ω≈–∂œ»Îø⁄
1592   4                              {
1593   5                                sys_res_status = 1;
1594   5                              }
1595   4                              if(sd_kind == 2&&sys_status==44)//ƒ£ Ω≈–∂œ»Îø⁄
1596   4                              {
1597   5                                PFID = recv_buf[1];
1598   5                                WLID = recv_buf[2];
1599   5                                weightL[0] = recv_buf[3];
1600   5                                weightL[1] = recv_buf[4];
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 27  

1601   5                                //÷ÿ¡ø∏≥÷µ
1602   5                              }
1603   4                            }
1604   3                      }
1605   2              else
1606   2              {
1607   3                intko++;
1608   3              }
1609   2              } 
1610   1              ES = 1;
1611   1      }
1612          
1613          
1614          /************************************************************/
1615          //void Serial_Int(void) interrupt 4 using 1
1616          //{
1617          //        ES = 0;
1618          //        if(RI == 1)   //µ±”≤º˛Ω” ’µΩ“ª∏ˆ ˝æ› ±£¨RIª·÷√Œª
1619          //        {
1620          //                if(SBUF == 0x54)//÷ª“™”ˆµΩTæÕ÷√0 ¥”0ø™ ºº∆ ˝£¨’‚∏ˆŒ™¡À∂¡»°º∆À„ª˙∑¢ÀÕµƒŒÔ¡œ ˝æ›◊º»∑
1621          //        {intko = 0;}
1622          //        recv_buf[intko] = SBUF;                //∞—¥”¥Æø⁄∂¡≥ˆµƒ ˝¥ÊµΩ ˝◊È
1623          //                RI = 0; 
1624          //                intko++;
1625          //                if(intko == 7)
1626          //                {
1627          //                        intko = 0;                //µ±com_dat = 21 ±£¨«Â0£¨∑¿÷π ˝◊È“Á≥ˆ
1628          //
1629          //            if(sys_status==17)//µ±17 ±£¨Ω¯»ÎœµÕ≥∆Ù∂Ø–≈∫≈Ω” ’£¨∆‰À˚–≈∫≈≤ª◊ˆ¥¶¿Ì
1630          //            {
1631          //              if(recv_buf[0] == 0x4F)//O»∑»œø™ª˙÷∏¡ÓΩ” ’
1632          //              {
1633          //                 if(recv_buf[1]== 0x50)//P
1634          //                 {sys_res_status = 31;}         
1635          //              }                       
1636          //            }
1637          //            if((sys_status==1||sys_status==18))//µ±1µƒ ±∫Ú£¨◊ˆŒÔ¡œIDŒÔ¡œ÷ÿ¡ø◊÷¥ÆΩ” ’£¨∆‰À˚◊¥Ã¨≤ª◊ˆ¥¶¿Ì°£
1638          //            {
1639          //              if((recv_buf[0]!=0x30) && (recv_buf[0]!=0x31) && (recv_buf[0]!= 0x41) &&(recv_buf[0]!= 0x45)&&(r
             -ecv_buf[0]!= 0x54))
1640          //              {;}
1641          //              else
1642          //              {
1643          //                if(recv_buf[0] == 0x41)//all
1644          //                  {sys_status = 7;
1645          //                 tick=0;}
1646          //                else if(recv_buf[0] == 0x45) //err
1647          //                  {
1648          //                    if(recv_buf[1]== 0x52)
1649          //                      {sys_status = 6;}
1650          //                    if(recv_buf[1]== 0x50)
1651          //                      {sys_status = 11;}
1652          //                    if(recv_buf[1]== 0x47)
1653          //                      {sys_status = 12;}                         
1654          //                  }
1655          //                else {sys_res_status = 1;sys_status=1;}
1656          //              }
1657          //            }
1658          //                }
1659          //        } 
1660          //        ES = 1;
1661          //}
C51 COMPILER V9.51   MAIN                                                                  06/27/2016 11:36:08 PAGE 28  



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4901    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =     76      20
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
